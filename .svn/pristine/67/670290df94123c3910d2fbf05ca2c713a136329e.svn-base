package com.evergrande.hdmp.usertags.mybatis.dao;

import com.evergrande.hdmp.usertags.entity.UserTagFavorite;
import org.apache.ibatis.session.SqlSession;
import org.apache.ibatis.session.SqlSessionFactory;
import org.junit.Assert;
import org.junit.BeforeClass;
import org.junit.Test;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

import java.io.IOException;
import java.util.List;

/**
 * @author Changhua, Wu
 *         Created on: 1/23/16,1:26 PM
 */
public class TagFavoriteDaoTest {



    private static final Logger logger = LoggerFactory.getLogger(TagFavoriteDaoTest.class);

    private static SqlSessionFactory sqlSessionFactory;


    @BeforeClass
    public static void init() throws IOException {

        sqlSessionFactory = MockDbUtils.initDB();

    }


    @Test
    public void testListAll() {

        SqlSession session = sqlSessionFactory.openSession();

        try {

            TagFavoriteDao tagFavoriteMapper = session.getMapper(TagFavoriteDao.class);

            List<UserTagFavorite> tagFavorites = tagFavoriteMapper.listAll();

            logger.debug("total available records: {}", tagFavorites.size());

            Assert.assertTrue(tagFavorites.size() > 0);

            for(UserTagFavorite userTagFavorite: tagFavorites) {
                logger.debug("user-> Favorite mapping: user_id={},  category_id={}", userTagFavorite.getUser_id(), userTagFavorite.getTag_ctgy_id() );
            }

        } finally {
            session.close();
        }

    }

    @Test
    public void testGetFavoriteTagIDsById() {

        SqlSession session = sqlSessionFactory.openSession();

        try {

            TagFavoriteDao tagFavoriteMapper = session.getMapper(TagFavoriteDao.class);

            int userId = 1;
            List<Integer> favoriteTags = tagFavoriteMapper.getFavoriteTagIDsByUser(userId);

            logger.debug("user {} have favoriteTags: {}",  userId, favoriteTags);

            Assert.assertTrue(favoriteTags.size()>0);

        } finally {
            session.close();
        }

    }



    @Test
    public void testFindAllByName() {

        SqlSession session = sqlSessionFactory.openSession();

        try {

            TagFavoriteDao tagFavoriteMapper = session.getMapper(TagFavoriteDao.class);

            int tag_category_id = 4;
            int numOfUsersWhoLoveTag = tagFavoriteMapper.getNumOfUsersWhoLoveTag( tag_category_id );

            logger.debug(" tag_category: {}  had been collected into {}  of user's Favorite.",  tag_category_id, numOfUsersWhoLoveTag);

            Assert.assertTrue(numOfUsersWhoLoveTag > 0);

        } finally {
            session.close();
        }

    }



}
